!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("react"),require("prop-types")):"function"==typeof define&&define.amd?define(["react","prop-types"],t):"object"==typeof exports?exports.rechatbot=t(require("react"),require("prop-types")):e.rechatbot=t(e.React,e.PropTypes)}(window,function(e,t){return function(e){function t(a){if(n[a])return n[a].exports;var r=n[a]={i:a,l:!1,exports:{}};return e[a].call(r.exports,r,r.exports,t),r.l=!0,r.exports}var n={};return t.m=e,t.c=n,t.d=function(e,n,a){t.o(e,n)||Object.defineProperty(e,n,{enumerable:!0,get:a})},t.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},t.t=function(e,n){if(1&n&&(e=t(e)),8&n)return e;if(4&n&&"object"==typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(t.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&n&&"string"!=typeof e)for(var r in e)t.d(a,r,function(t){return e[t]}.bind(null,r));return a},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="dist/",t(t.s=4)}([function(t,n){t.exports=e},function(e,n){e.exports=t},function(e,t,n){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var r=n(6);Object.defineProperty(t,"serializeUserAnswer",{enumerable:!0,get:function(){return a(r).default}});var s=n(7);Object.defineProperty(t,"mergeMessage",{enumerable:!0,get:function(){return a(s).default}})},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=function(e){return e&&e.__esModule?e:{default:e}}(n(0));t.default=function(){return a.default.createElement("div",{className:"loading"},a.default.createElement("span",null,"."),a.default.createElement("span",null,"."),a.default.createElement("span",null,"."))}},function(e,t,n){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.serializeUserAnswer=t.mergeMessage=t.Loading=void 0;var r=a(n(5)),s=a(n(3)),i=n(2);t.Loading=s.default,t.mergeMessage=i.mergeMessage,t.serializeUserAnswer=i.serializeUserAnswer,t.default=r.default},function(e,t,n){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},s=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),i=a(n(0)),l=a(n(1)),o=n(2),u=a(n(8)),d=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.state={loading:!1,finished:!1,userInput:!1,inputCall:null,lastMsg:null,notUnderstand:e.options.filter(function(e){return null===e.id})[0],callMessages:[]},n.callTimer=null,n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,i.default.Component),s(t,[{key:"getMessage",value:function(e){return this.props.options.filter(function(t){if(t.id)return t.id instanceof RegExp?new RegExp(t.id).test(e.text):t.id.toLowerCase()===e.text.toLowerCase()})[0]}},{key:"handleNewMessage",value:function(e){e.isUser?(this.renderMessage(e),this.sendBotReply(e)):this.renderDelayMessage(e),e.finish&&this.setState({finished:!0})}},{key:"sendBotReply",value:function(e){var t=this.state,n=t.notUnderstand,a=t.inputCall,r=a?this.getMessageById(a):this.getMessage(e)||n;if(!r)throw new Error('Missing message "not understand". Add to the list of options object { id: null, text: "..." }');if(r.text)this.renderDelayMessage(r,e);else if(r.call){var s=this.getMessageById(r.call);this.handleNewMessage(s)}else this.renderDelayMessage(r,e)}},{key:"renderMessage",value:function(e){var t=this.props.onSendMessage;t&&t(e)}},{key:"renderDelayMessage",value:function(e,t){var n=this,a=this.props,r=a.onSendMessage,s=a.delay;this.setState({loading:!0,userInput:!!e.input,inputCall:e.input?e.call:null,lastMsg:e}),r&&setTimeout(function(){if(r(Object.assign({},e,{last:t})),n.setState({loading:!1}),e.call&&!n.state.userInput){var a=n.getMessageById(e.call);n.renderDelayMessage(a)}},e.delay||s)}},{key:"onInputReply",value:function(e){var t=this.state,n=t.inputCall,a=t.lastMsg;"Enter"!==e.key||a.validator&&!a.validator(e.target.value)||(this.handleNewMessage((0,o.serializeUserAnswer)(e.target.value,{nextId:n,lastId:a.id,input:!0})),e.target.value="")}},{key:"sendAction",value:function(e){"function"==typeof e?e():this.handleNewMessage((0,o.serializeUserAnswer)(e))}},{key:"getMessageById",value:function(e){var t=this.props.options;return e?t.filter(function(t){return e===t.id})[0]:[]}},{key:"getWelcomeMessage",value:function(){var e=this.props.welcomeId;return this.getMessageById(e)}},{key:"componentDidMount",value:function(){var e=this.getWelcomeMessage();this.handleNewMessage(e)}},{key:"componentDidUpdate",value:function(){this.messages&&(this.messages.scrollTop=this.messages.scrollHeight-this.messages.clientHeight)}},{key:"render",value:function(){var e=this,t=this.props,n=t.messages,a=t.animation,s=t.hideAvatar,l=t.hideUserMessage,o=t.avatars,d=t.inputPlaceholder,f=this.state,c=f.loading,p=f.finished;return i.default.createElement("div",{className:"chat"},i.default.createElement("ul",{ref:function(t){return e.messages=t},className:"chat__messages"},n.map(function(t,n){return t.isUser&&l?null:i.default.createElement(u.default,r({hideAvatar:s,avatars:o,sendAction:e.sendAction.bind(e),key:t.id+"_"+n,animation:a},t))}),c&&i.default.createElement(u.default,{loading:!0,hideAvatar:s,avatars:o})),i.default.createElement("div",{className:"chat__input"},i.default.createElement("input",{disabled:p,onKeyUp:this.onInputReply.bind(this),type:"text",placeholder:d})))}}]),t}();d.defaultProps={hideUserMessage:!1,hideAvatar:!1,messages:[],options:[],welcomeId:null,delay:1e3,avatars:null,inputPlaceholder:"Enter you answer...",animation:"none"},d.propTypes={hideUserMessage:l.default.bool,hideAvatar:l.default.bool,inputPlaceholder:l.default.string,delay:l.default.number,welcomeId:l.default.oneOfType([l.default.string,l.default.number]),options:l.default.array.isRequired,messages:l.default.array.isRequired,avatars:l.default.object,onSendMessage:l.default.func.isRequired,animation:l.default.string},t.default=d},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){return Object.assign({},{text:e,isUser:!0},t)}},function(e,t,n){"use strict";function a(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){return{messages:[].concat(a(e.messages),[Object.assign({},t,{formData:e.formData})])}}},function(e,t,n){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var r=a(n(0)),s=a(n(9)),i=a(n(1)),l=a(n(3)),o=function(e){var t=e.sendAction,n=e.loading,a=e.text,i=e.buttons,o=e.avatars,u=e.image,d=e.isUser,f=e.hideAvatar,c=e.animation;return r.default.createElement("li",{className:(0,s.default)("chat__message","chat__message--"+(d?"user":"bot"))},!f&&r.default.createElement("div",{className:"chat__avatar",style:{backgroundImage:o&&"url("+(d?o.user:o.bot)+")"}}),r.default.createElement("div",{className:(0,s.default)("chat__content","chat__content--"+c)},(n||a)&&r.default.createElement("div",{className:(0,s.default)("chat__text")},"function"==typeof a?a(e):a,n&&r.default.createElement(l.default,null)),u&&r.default.createElement("div",{className:"chat__image",style:{backgroundImage:"url("+u+")"}}),i.length>0&&r.default.createElement("div",{className:"chat__buttons"},i.map(function(e,n){return r.default.createElement("button",{key:n,onClick:t&&t.bind(void 0,e.callback)},e.label)}))))};o.defaultProps={loading:!1,text:"",buttons:[],avatars:{},image:"",animation:"none",isUser:!1,hideAvatar:!1,sendAction:null},o.propTypes={sendAction:i.default.oneOfType([null,i.default.func]),loading:i.default.bool,text:i.default.oneOfType([i.default.string,i.default.object,i.default.func]),buttons:i.default.array,avatars:i.default.object,image:i.default.string,isUser:i.default.bool,hideAvatar:i.default.bool,animation:i.default.string},t.default=o},function(e,t,n){var a;!function(){"use strict";function n(){for(var e=[],t=0;t<arguments.length;t++){var a=arguments[t];if(a){var s=typeof a;if("string"===s||"number"===s)e.push(a);else if(Array.isArray(a))e.push(n.apply(null,a));else if("object"===s)for(var i in a)r.call(a,i)&&a[i]&&e.push(i)}}return e.join(" ")}var r={}.hasOwnProperty;e.exports?e.exports=n:void 0!==(a=function(){return n}.apply(t,[]))&&(e.exports=a)}()}])});